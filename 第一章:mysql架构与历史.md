
# 第一章:mysql架构与历史

- 锁
  - 锁的类型
    - 共享锁(shard lock)也叫读锁(read lock)
    - 排他锁(exclusive lock)也叫写锁(wirte lock)
  - 粒度
    - 表锁（开销小）
    - 行级锁
- 事务
  - ACID
    - 原子性 (atomicity) 事务不可拆分
    - 一致性 (consistency) 结果状态一致
    - 隔离性 (isolation) 事务间不可见
    - 持久性 (durability) 提交后永久保存
- 隔离级别
  - 未读提交 (read uncommited) 存在脏读，很少使用
  - 提交读 (read commited) 事务隔离，不可重复读
  - 可重复读 (repeatable read) 默认隔离级别，存在幻读，可通过多版本并发控制解决
  - 可串行化 (serializable) 最高隔离级别，强一致，性能低
- 死锁
  - 为锁请求添加超时时间
  - innodb 将持有最少排他锁的事务回滚
- 多版本并发控制（mvcc 基于innodb）
  - 为每行记录添加两个列：创建时间、过期时间 （并非真实时间，而是系统版本号）
  - SELECT
    - 第一步查找版本小于当前事务版本的数据，第二步查找过期时间未设置或者过期版本好大于当前版本的数据
  - INSERT
    - 设置为当前系统版本号(创建时间字段)
  - DELETE
    - 设置为当前系统版本号(删除时间字段) 
  - UPDATE
    - 第一步插入一条新数据，创建时间设置为当前版本号;第二步将原数据过期时间字段设置为当前版本号
- 存储引擎
  - 每个数据库一个目录
  - 表结构存放在与表同名的 .frm文件中
  - innodb
    - 性能好，自动崩溃恢复，推荐使用
  - myisam
    - 不支持事务和行级锁，无所崩溃恢复
    - 
